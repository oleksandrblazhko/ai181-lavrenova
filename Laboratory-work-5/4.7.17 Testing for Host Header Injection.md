# Тестування ін'єкції заголовка хосту

<p><img width="109" alt="image" src="https://user-images.githubusercontent.com/52915030/202174008-f29ebd50-b272-4402-9f51-8734fdd6711d.png">
 </p>
 
## Резюме
Веб-сервер зазвичай розміщує кілька веб-програм на одній IP-адресі, звертаючись до кожної програми через віртуальний хост. У вхідному HTTP-запиті веб-сервери часто надсилають запит цільовому віртуальному хосту на основі значення, указаного в заголовку Host. Без належної перевірки значення заголовка зловмисник може надати недійсні вхідні дані, щоб змусити веб-сервер:

* надсилати запити на перший віртуальний хост у списку
* викликати переспрямування на контрольований зловмисником домен
* виконати отруєння веб-кешу
* маніпулювати функцією скидання пароля
## Як тестувати
Початкове тестування таке ж просте, як надання іншого домену (наприклад, attacker.com) у полі заголовка Host. Саме те, як веб-сервер обробляє значення заголовка, визначає вплив. Атака дійсна, коли веб-сервер обробляє вхідні дані для надсилання запиту на контрольований зловмисником хост, який знаходиться в наданому домені, а не на внутрішній віртуальний хост, який знаходиться на веб-сервері.

<p><img width="571" alt="image" src="https://user-images.githubusercontent.com/52915030/202174215-c00d1965-af6f-4495-8691-1386c68b25e3.png">
 </p>
 
 У найпростішому випадку це може спричинити перенаправлення 302 на наданий домен.
 
 <p><img width="256" alt="image" src="https://user-images.githubusercontent.com/52915030/202174341-e1bdb163-9e31-4e02-ae99-c4b9e6e7b7d0.png">
 </p>
 
Крім того, веб-сервер може надіслати запит першому віртуальному хосту в списку.

## Обхід заголовка хосту, перенаправленого X
Якщо впровадження заголовка Host пом’якшується шляхом перевірки недійсних введених даних через заголовок Host, ви можете надати значення в заголовок X-Forwarded-Host.

<p> <img width="210" alt="image" src="https://user-images.githubusercontent.com/52915030/202174490-6a4df1f4-f068-47c3-8130-344fe125f7b6.png">
</p>

Потенційно створює вихідні дані на стороні клієнта, наприклад:

<p><img width="254" alt="image" src="https://user-images.githubusercontent.com/52915030/202174556-967862e8-bdfb-40f7-8d24-70931135ff14.png">
 </p>
 
 Знову ж таки, це залежить від того, як веб-сервер обробляє значення заголовка.

## Отруєння веб-кеша
Використовуючи цю техніку, зловмисник може маніпулювати веб-кешем, щоб надати отруєний вміст усім, хто його запитує. Це залежить від здатності отруїти проксі-сервер кешування, який запускається самою програмою, CDN або іншими провайдерами. У результаті жертва не матиме контролю над отриманням шкідливого вмісту під час запиту вразливої програми.

<p> <img width="138" alt="image" src="https://user-images.githubusercontent.com/52915030/202174678-399426f1-be80-4bec-a3f0-577d1b66290d.png">
</p>

Коли жертва відвідує вразливу програму, з веб-кешу буде подано наступне.

<p> <img width="259" alt="image" src="https://user-images.githubusercontent.com/52915030/202174782-5b5f1b1e-be36-4e73-ba00-f5dc58cb908b.png">
 </p>
 
## Отруєння для скидання пароля
Функція скидання пароля зазвичай включає значення заголовка Host під час створення посилань для скидання пароля, які використовують згенерований секретний маркер. Якщо програма обробляє контрольований зловмисником домен для створення посилання для скидання пароля, жертва може натиснути посилання в електронному листі та дозволити зловмиснику отримати маркер скидання, таким чином скидаючи пароль жертви.
<p> <img width="512" alt="image" src="https://user-images.githubusercontent.com/52915030/202174887-d1683e45-f138-4ad0-b7a4-309d98a7d636.png">
</p>
